"use client";import React, { useEffect, useState } from "react";import { Box, Typography } from "@mui/material";import Select from "@/app/components/Select";import { PriceList, Rubro } from "@/app/lib/types/types";import { priceListsApi } from "@/app/lib/api/price-lists";interface PriceListSelectorProps {  selectedPriceListId: number | null;  onPriceListChange: (priceListId: number | null) => void;  rubro: Rubro;  disabled?: boolean;}const PriceListSelector: React.FC<PriceListSelectorProps> = ({  selectedPriceListId,  onPriceListChange,  rubro,  disabled = false,}) => {  const [priceLists, setPriceLists] = useState<PriceList[]>([]);  const [loading, setLoading] = useState(true);  useEffect(() => {    const loadPriceLists = async () => {      if (rubro === "Todos los rubros") {        setPriceLists([]);        setLoading(false);        return;      }      try {        setLoading(true);        const allLists = await priceListsApi.getAll();        const lists = allLists.filter((list: PriceList) =>           list.rubro === rubro && list.isActive !== false        );        if (lists.length === 0) {          const defaultPriceList: Omit<PriceList, 'id' | 'createdAt' | 'updatedAt'> = {            name: "General",            rubro,            isDefault: true,            isActive: true,          };          await priceListsApi.create(defaultPriceList);          const updatedAllLists = await priceListsApi.getAll();          const updatedLists = updatedAllLists.filter((list: PriceList) =>              list.rubro === rubro && list.isActive !== false          );          setPriceLists(updatedLists);        } else {          setPriceLists(lists);        }        if (!selectedPriceListId && lists.length > 0) {          const defaultList = lists.find((list) => list.isDefault);          if (defaultList) {            onPriceListChange(defaultList.id);          } else {            onPriceListChange(lists[0].id);          }        }      } catch (err) {        console.error("Error loading price lists:", err);      } finally {        setLoading(false);      }    };    loadPriceLists();  }, [rubro, selectedPriceListId, onPriceListChange]);   const options = priceLists.map((list) => ({    value: list.id.toString(),    label: list.isDefault ? `${list.name} (Por defecto)` : list.name,    metadata: list,  }));  if (options.length > 0) {    const uniqueIds = new Set(options.map((opt) => opt.value));    const uniqueNames = new Set(options.map((opt) => opt.label));    if (uniqueIds.size !== options.length) {      console.warn("¡Hay IDs duplicados en las opciones del selector!");    }    if (uniqueNames.size !== options.length) {      console.warn("¡Hay nombres duplicados en las opciones del selector!");    }  }  if (loading) {    return (      <Box sx={{ width: "100%" }}>        <Typography variant="body2" fontWeight="medium" sx={{ mb: 1 }}>          Lista de precios        </Typography>        <Select          label="Cargando..."          options={[]}          value=""          onChange={() => {}}          fullWidth          size="small"          disabled={true}        />      </Box>    );  }  return (    <Box sx={{ width: "100%" }}>      <Typography variant="body2" fontWeight="medium" sx={{ mb: 1 }}>        Lista de precios      </Typography>      <Select        label="Seleccionar lista"        options={options}        value={selectedPriceListId ? selectedPriceListId.toString() : ""}        onChange={(value) => {          if (value === "") {            onPriceListChange(null);          } else {            onPriceListChange(Number(value));          }        }}        fullWidth        size="small"        disabled={disabled || priceLists.length === 0}        getOptionId={(option) => option.metadata?.id?.toString()}      />      {priceLists.length === 0 && rubro !== "Todos los rubros" && (        <Typography variant="caption" color="text.secondary">          No hay listas de precios creadas para este rubro        </Typography>      )}    </Box>  );};export default PriceListSelector;