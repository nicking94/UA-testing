import { Injectable } from '@nestjs/common';import { PrismaService } from '../prisma/prisma.service';@Injectable()export class BudgetsService {  constructor(private prisma: PrismaService) {}  async findAll(filters?: { customerId?: string; status?: string }) {    const where: any = {};    if (filters?.customerId) where.customerId = filters.customerId;    if (filters?.status) where.status = filters.status;    return this.prisma.budget.findMany({      where,      include: { customer: true, items: true, budgetNotes: true },      orderBy: { createdAt: 'desc' },    });  }  async findOne(id: string) {    return this.prisma.budget.findUnique({      where: { id },      include: { customer: true, items: true, budgetNotes: true },    });  }  async create(data: any) {    return this.prisma.budget.create({      data: {        ...data,        items: {          create: data.items.map((item: any) => ({            productId: item.productId,            productName: item.productName,            quantity: item.quantity,            unit: item.unit,            price: item.price,            size: item.size,            color: item.color,            discount: item.discount || 0,            surcharge: item.surcharge || 0,            basePrice: item.basePrice,            notes: item.notes,            description: item.description,            rubro: item.rubro,            costPrice: item.costPrice,            profit: item.profit,            profitPercentage: item.profitPercentage,          })),        },      },      include: { customer: true, items: true },    });  }  async update(id: string, data: any) {    await this.prisma.budgetItem.deleteMany({ where: { budgetId: id } });    return this.prisma.budget.update({      where: { id },      data: {        ...data,        items: {          create: data.items.map((item: any) => ({            productId: item.productId,            productName: item.productName,            quantity: item.quantity,            unit: item.unit,            price: item.price,            size: item.size,            color: item.color,            discount: item.discount || 0,            surcharge: item.surcharge || 0,            basePrice: item.basePrice,            notes: item.notes,            description: item.description,            rubro: item.rubro,            costPrice: item.costPrice,            profit: item.profit,            profitPercentage: item.profitPercentage,          })),        },      },      include: { customer: true, items: true },    });  }  async delete(id: string) {    return this.prisma.budget.delete({ where: { id } });  }}