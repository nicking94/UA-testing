import { Injectable } from '@nestjs/common';import { PrismaService } from '../prisma/prisma.service';@Injectable()export class CustomersService {  constructor(private prisma: PrismaService) {}  async findAll(filters?: {    search?: string;    status?: string;    rubro?: string;  }) {    const where: any = {};    if (filters?.search) {      where.OR = [        { name: { contains: filters.search, mode: 'insensitive' } },        { id: { contains: filters.search, mode: 'insensitive' } },        { phone: { contains: filters.search, mode: 'insensitive' } },      ];    }    if (filters?.status) {      where.status = filters.status;    }    if (filters?.rubro) {      where.rubro = filters.rubro;    }    return this.prisma.customer.findMany({      where,      include: {        _count: {          select: {            sales: true,            budgets: true,          },        },      },      orderBy: { name: 'asc' },    });  }  async findOne(id: string) {    return this.prisma.customer.findUnique({      where: { id },      include: {        sales: {          take: 10,          orderBy: { date: 'desc' },        },        budgets: {          take: 10,          orderBy: { createdAt: 'desc' },        },        customerNotes: {          orderBy: { createdAt: 'desc' },        },      },    });  }  async create(data: any) {    return this.prisma.customer.create({      data: {        id: data.id.toLowerCase(),        name: data.name,        phone: data.phone,        email: data.email,        address: data.address,        cuitDni: data.cuitDni,        status: data.status || 'activo',        rubro: data.rubro,        notes: data.notes,        isTemporary: data.isTemporary || false,      },    });  }  async update(id: string, data: any) {    return this.prisma.customer.update({      where: { id },      data: {        name: data.name,        phone: data.phone,        email: data.email,        address: data.address,        cuitDni: data.cuitDni,        status: data.status,        rubro: data.rubro,        notes: data.notes,      },    });  }  async delete(id: string) {    return this.prisma.customer.delete({      where: { id },    });  }  async updateBalance(id: string, amount: number) {    const customer = await this.prisma.customer.findUnique({      where: { id },    });    return this.prisma.customer.update({      where: { id },      data: {        pendingBalance: (customer?.pendingBalance || 0) + amount,      },    });  }}